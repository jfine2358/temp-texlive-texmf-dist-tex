%
% plsiunitx.sty
% written by Hironobu Yamashita (@aminophen)
%
% This package is part of the plautopatch bundle.
% https://github.com/aminophen/plautopatch
% (mostly based on lltjp-siunitx.sty 2018-11-02)
%
% This package is expected to be compatible with
%   * siunitx.sty
%     (????/??/?? v?.?? -- 2018/05/17 v2.7s)
%   * plarray.sty in platex-tools
%     (2018/03/01 v0.1d -- 2018/10/27 v0.1h)
%

%% package declaration
\NeedsTeXFormat{pLaTeX2e}
\ProvidesPackage{plsiunitx}
  [2018/11/04 v0.2 siunitx package for pLaTeX/upLaTeX]
\RequirePackageWithOptions{siunitx}
\RequirePackage{plarray}% siunitx requires array

\ExplSyntaxOn

%% patching internal code for siunitx.sty
%
%% inhibit JFM glue around tabular cell components (pLaTeX2e 2018/03/09)
\@ifl@t@r{\pfmtversion}{2017/07/29}{\@firstofone}{\@gobble}
{% = for pLaTeX2e 2017/07/29 or newer
%% new table column: S and s
\@ifpackageloaded{mdwtab}{}{%
  \cs_set_protected:Npn \__siunitx_table_collect_not_braced:N #1
    {
      \token_if_eq_meaning:NNF #1 \relax {
      \token_if_eq_meaning:NNF #1 \pltx@next@inhibitglue {
      \token_if_eq_meaning:NNF #1 \removejfmglue {
      \token_if_eq_meaning:NNF #1 \tex_ignorespaces:D
        {
          \token_if_eq_meaning:NNF #1 \tex_unskip:D
            { \__siunitx_table_collect_not_braced_aux_i:N #1 }
        }
      }}}
      \__siunitx_table_collect_next:
    }
  }
}% =
%
%% done

\ExplSyntaxOff

\endinput
