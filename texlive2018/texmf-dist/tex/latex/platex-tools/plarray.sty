%
% plarray.sty
% written by Hironobu Yamashita (@aminophen)
%
% This package is part of the platex-tools bundle.
% https://github.com/aminophen/platex-tools
%
% This package `plarray.sty' is based on:
%   * array.sty in latex-tools (2016/10/06 v2.4d)
%   * plcore.ltx in platex (2018/03/12 v1.2y)
%

\NeedsTeXFormat{pLaTeX2e}
\ProvidesPackage{plarray}
  [2018/03/12 v0.1e Tabular extension package for pLaTeX/upLaTeX]
\RequirePackage{array}

%% patching internal code for array.sty
%
%% remove extra \xkanjiskip (pLaTeX2e 2016/04/17)
\def\@tabular{%
  \leavevmode \null
  \hbox \bgroup $\col@sep\tabcolsep \let\d@llarbegin\begingroup
                                    \let\d@llarend\endgroup
  \@tabarray}
\def\endtabular{\endarray $\egroup\null}
\expandafter \let \csname endtabular*\endcsname = \endtabular
%
%% inhibit JFM glue around tabular cell components (pLaTeX2e 2018/03/09)
% first, provide old definition; there are some known incompatibility
% compared to LaTeX, pLaTeX or array
\def\insert@column{%
   \the@toks \the \@tempcnta
   \mbox{}\inhibitglue \ignorespaces \@sharp \unskip \unskip
   \the@toks \the \count@ \relax}
\ifx\pltx@next@inhibitglue\@undefined\else
  \ifx\removejfmglue\@undefined\else
    % both macros are available, override with new definition
    % (= pLaTeX2e 2018/03/09 or later, built on e-(u)pTeX 180226)
    \def\insert@column{%
       \the@toks \the \@tempcnta
       \relax \pltx@next@inhibitglue
       \ignorespaces \@sharp \unskip \removejfmglue
       \the@toks \the \count@ \relax}
  \fi
\fi
%
%% done

%% all done

\endinput
