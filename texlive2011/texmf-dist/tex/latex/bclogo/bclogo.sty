\NeedsTeXFormat{LaTeX2e}
\def\PackageName{bclogo}
\def\fileversion{v2.24}
\def\filedate{2009/09/09}
\ProvidesPackage{bclogo}
   [\filedate\space\fileversion]
\RequirePackage{xkeyval,ifthen}

%% Les options globales du package sont au nombre de 2: tikz ou pstricks

\newif\iftikz%
\newif\ifblur
\define@key{bclogo.sty}{tikz}[]{\tikztrue}%
\define@key{bclogo.sty}{pstricks}[]{\tikzfalse}%
\define@key{bclogo.sty}{blur}[]{\blurtrue}%
\newlength{\logowidth}\setlength{\logowidth}{17pt}%
\ProcessOptionsX%


\iftikz%
\RequirePackage{tikz}%
\usetikzlibrary{shadows}% pour l'ombre
\usetikzlibrary{decorations.pathmorphing} % pour la barre ondulee
\else%
\ifblur\RequirePackage{pst-blur}\fi%
\RequirePackage{graphicx}%
\RequirePackage{pstricks}%
\RequirePackage{pst-grad}%
\RequirePackage{pst-coil}% pour la barre ondulee
\fi%

% les symboles
% ==============================================================================

% la fleur
\newcommand\bcfleur{\includegraphics[width=\logowidth]{bc-fleur}}
% une note (Thomas Labarussias)
\newcommand\bcnote{\includegraphics[width=\logowidth]{bc-note}}
% panneau chantier (Jean-Michel Sarlat)
\newcommand\bcpanchant{\includegraphics[width=\logowidth]{bc-aux-301}}
% ours
%\newcommand\bcours{\begingroup\input{bc-ours.tex}\endgroup}
\newcommand\bcours{\includegraphics[width=\logowidth]{bc-ours}}
% etoile
%\newcommand\bcetoile{\begingroup\input{bc-etoile.tex}\endgroup}
\newcommand\bcetoile{\includegraphics[width=\logowidth]{bc-etoile}}
% attention
%\newcommand\bcattention{\begingroup\input{bc-attention.tex}\endgroup}
\newcommand\bcattention{\includegraphics[width=\logowidth]{bc-attention}}
% attention P.Fradin
\newcommand\bctakecare{\includegraphics[width=\logowidth]{bc-takecare}}
% lampe P.Fradin
\newcommand\bclampe{\includegraphics[width=\logowidth]{bc-lampe}}
% coeur
\newcommand\bccoeur{\includegraphics[width=\logowidth]{bc-coeur}}
% ornement (tire du site http://openclipart.org )
\newcommand\bcorne{\includegraphics[width=\logowidth]{bc-orne}}
% danger (Francois)
\newcommand\bcdanger{\includegraphics[width=\logowidth]{bc-danger}}
% smiley bonne humeur (Francois)
\newcommand\bcsmbh{\includegraphics[width=\logowidth]{bc-smiley-bonnehumeur}}
% smiley bonne humeur (Francois)
\newcommand\bcsmmh{\includegraphics[width=\logowidth]{bc-smiley-mauvaisehumeur}}
% le trefle
\newcommand\bctrefle{\includegraphics[width=\logowidth]{bc-trefle}}
% le livre
\newcommand\bcbook{\includegraphics[width=\logowidth]{bc-book}}
% point d'interrogation
\newcommand\bcquestion{\includegraphics[width=\logowidth]{bc-inter}}
% crayon anne-sophie philippe
\newcommand\bccrayon{\includegraphics[width=\logowidth]{bc-crayon}}
% info (thomas labarrussias)
\newcommand\bcinfo{\includegraphics[width=\logowidth]{bc-info}}
% plume
\newcommand\bcplume{\includegraphics[width=\logowidth]{bc-plume}}
% le pic LaTeX
\newcommand\bcspadesuit{{\centering \huge $\spadesuit$}}
% logos Alphonse Capriani
\newcommand\bcbombe{\includegraphics[width=\logowidth]{bcbombe}}
\newcommand\bccube{\includegraphics[width=\logowidth]{bccube}}
\newcommand\bcdallemagne{\includegraphics[width=\logowidth]{bcdallemagne}}
\newcommand\bcdbelgique{\includegraphics[width=\logowidth]{bcdbelgique}}
\newcommand\bcdfrance{\includegraphics[width=\logowidth]{bcdfrance}}
\newcommand\bcditalie{\includegraphics[width=\logowidth]{bcditalie}}
\newcommand\bcdodecaedre{\includegraphics[width=\logowidth]{bcdodecaedre}}
\newcommand\bcdpaysbas{\includegraphics[width=\logowidth]{bcdpaysbas}}
\newcommand\bceclaircie{\includegraphics[width=\logowidth]{bceclaircie}}
\newcommand\bcicosaedre{\includegraphics[width=\logowidth]{bcicosaedre}}
\newcommand\bcinterdit{\includegraphics[width=\logowidth]{bcinterdit}}
\newcommand\bcneige{\includegraphics[width=\logowidth]{bcneige}}
\newcommand\bcoctaedre{\includegraphics[width=\logowidth]{bcoctaedre}}
\newcommand\bcpluie{\includegraphics[width=\logowidth]{bcpluie}}
\newcommand\bcpoisson{\includegraphics[width=\logowidth]{bcpoisson}}
\newcommand\bcsoleil{\includegraphics[width=\logowidth]{bcsoleil}}
\newcommand\bcstop{\includegraphics[width=\logowidth]{bcstop}}
\newcommand\bctetraedre{\includegraphics[width=\logowidth]{bctetraedre}}
\newcommand\bccalendrier{\includegraphics[width=\logowidth]{bccalendrier}}
\newcommand\bchorloge{\includegraphics[width=\logowidth]{bchorloge}}
\newcommand\bcying{\includegraphics[width=\logowidth]{bcying}}
\newcommand\bcrosevents{\includegraphics[width=\logowidth]{bcrosevents}}
% fin alphonse
% Vincent Pantaloni route glissante
\newcommand\bcdz{\includegraphics[width=\logowidth]{bc-dz}}
% =========================== La fonction listable =============================

\newcommand{\titrebclogo}{Liste des \texttt{bclogo}}
\newcommand\bccaption[1]{\addcontentsline{bcl}{bclogo}{#1}}
\newcommand\listofbclogo{\section*{\titrebclogo}\@starttoc{bcl}}
\newcommand\l@bclogo[2]{\par\noindent #1,~\textit{page~#2}}
\newcounter{bclogocompteur} % idee de Francois Petiard

% ======================================= les keys =============================

\newlength{\val@epBarre} % on definit une longueur : l'epaisseur de la barre en point
\newlength{\val@framesep} % on definit une longueur : l'epaisseur de la marge en point
\newlength{\val@tailleOndu} % on definit une longueur : taille d'une ondulation
\newlength{\val@borderWidth} % on definit une longueur : epaisseur du bord   
\define@key{bclogo}{logo}[\bcfleur]{\def\val@logo{#1}}
\define@key{bclogo}{couleur}[white]{\def\val@couleur{#1}}
\define@key{bclogo}{arrondi}[0]{\def\val@arrondi{#1}}
\define@key{bclogo}{epOmbre}[0.125]{\def\val@epOmbre{#1}}
\define@key{bclogo}{arrondi}[0]{\def\val@arrondi{#1}}
\define@key{bclogo}{couleurOmbre}[black]{\def\val@couleurOmbre{#1}}
\define@key{bclogo}{couleurBarre}[black]{\def\val@couleurBarre{#1}}
\define@key{bclogo}{couleurBord}[black]{\def\val@couleurBord{#1}} % modification Philippe Fortemps
\define@key{bclogo}{imageBarre}[]{\def\val@imageBarre{#1}}
\define@key{bclogo}{motifBarre}[*]{\def\val@motifBarre{#1}}
\define@key{bclogo}{marge}[4]{\setlength{\val@framesep}{#1 pt}\iftikz\else\setlength{\psframesep}{#1 pt}\fi} 
\define@key{bclogo}{sousTitre}[]{\def\val@sousTitre{#1}} 
\define@key{bclogo}{epBarre}[1.5]{\setlength{\val@epBarre}{#1 pt}}
\define@key{bclogo}{epBord}[0.8]{\setlength{\val@borderWidth}{#1 pt}}%    
\define@key{bclogo}{tailleOndu}[2.5]{\setlength{\val@tailleOndu}{#1 pt}}
\define@boolkey{bclogo}{cadreTitre}[true]{}
\define@boolkey{bclogo}{noborder}[true]{}
\define@boolkey{bclogo}{ombre}[true]{}
\define@boolkey{bclogo}{avecBarre}[true]{} 
\define@boolkey{bclogo}{blur}[true]{}
\define@choicekey{bclogo}{barre}{none,line,snake,motif,zigzag,imageExt,imageClip, wave}[line]{%
\ifthenelse{\equal{#1}{none}}{\KV@bclogo@avecBarrefalse}%
{\def\bc@barre{\@nameuse{bc@barre#1}}}%
}%

% selection par defaut
\presetkeys{bclogo}{logo,barre,couleur,arrondi,couleurOmbre,couleurBarre,epOmbre,epBarre,epBord,tailleOndu,ombre=false,cadreTitre=false, avecBarre=true,noborder=false,marge,sousTitre, couleurBord,blur=false}{}% 

% les differente commande de barre vertical a gauche

\newcommand{\bc@barreline}{\color{\val@couleurBarre}\vrule width \val@epBarre}%

\newcommand{\bc@barremotif}{%
\begin{minipage}{\logowidth}\color{\val@couleurBarre}\centering%
\vbox to \invboxh{\cleaders\vbox{\vss \val@motifBarre \vss}\vfill}% 
\end{minipage}}

\newcommand{\bc@barrewave}{%
\begin{minipage}{\logowidth}\color{\val@couleurBarre}\centering%
\vbox to \invboxh{\cleaders\vbox{\vss $\leftwave\right.$ \vss}\vfill}% 
\end{minipage}}

\newcommand{\bc@barresnake}{%
\begin{minipage}{\logowidth}\centering
\iftikz
\begin{tikzpicture}[decoration={snake,segment length=2.66\val@tailleOndu, amplitude=\val@tailleOndu}]
\draw[decorate,line width=1pt, color=\val@couleurBarre](0,\invboxh)--(0,0);\end{tikzpicture}%
\else
\psset{unit=1pt}
\begin{pspicture}(0,0)(0,\invboxh)
\pszigzag[coilarm=0pt,coilwidth=2\val@tailleOndu,linewidth=1pt, linearc=1pt,coilheight=1.33,linecolor=\val@couleurBarre](0,\invboxh)(0,0)
\end{pspicture}%
\fi
\end{minipage}}%

\newcommand{\bc@barrezigzag}{%
\begin{minipage}{\logowidth}\centering
\iftikz
\begin{tikzpicture}[decoration={zigzag,segment length=2.66\val@tailleOndu, amplitude=\val@tailleOndu}]
\draw[decorate,line width=1pt,color=\val@couleurBarre](0,\invboxh)--(0,0);\end{tikzpicture}%
\else
\psset{unit=1pt}
\begin{pspicture}(0,0)(0,\invboxh)
\pszigzag[coilarm=0pt,coilwidth=2\val@tailleOndu,linewidth=1pt,coilheight=1.33,linecolor=\val@couleurBarre](0,\invboxh)(0,0)
\end{pspicture}%
\fi
\end{minipage}}%

\newcommand{\bc@barreimageExt}{% l'image est deformee
\begin{minipage}{\logowidth}\centering
\includegraphics[width=\logowidth,height=\invboxh]{\val@imageBarre}
\end{minipage}
}%

\newcommand{\bc@barreimageClip}{%
\begin{minipage}{\logowidth}\centering
\includegraphics[viewport=0 0 \logowidth~ \invboxh,%
clip=true]{\val@imageBarre}%
\end{minipage}
}%


%======================= Quelques definitions===================================
% boite globale
\newsavebox{\envbox}
% boite interieure la ligne 2 du tableau barre + texte
\newsavebox{\invbox}
% pour la hauteur de la boite
\newlength{\invboxh}\newlength{\invboxd}
%%% precaution JCC
\newcommand*\bclogotitre{}
\newcommand\styleSousTitre[1]{\normalsize \textit{#1}}
%======================= L'environnement =======================================

\newenvironment*{bclogo}[2][]{%
  \setkeys{bclogo}{#1}%on recupere les options
  % on definit les commandes qui seront utilisees dans la seconde
  % parti de l'environnement
  % la commande pour le titre
  \renewcommand*\bclogotitre{#2}
  % La commande pour les coins arrondis
  \newcommand{\arr}{\val@arrondi}
  % deux types de titres
  \ifKV@bclogo@cadreTitre% si cadreTitre = true
  \newcommand{\structitre}{%
    \iftikz% cadreTitre tizk
    \hfil
    \begin{tikzpicture}\node[rectangle, thick, top color=red!60!green!40, bottom color=white,draw]{\large #2};
    \end{tikzpicture}%
    \hfil%
    \else% cadreTitre pstricks
    \hfil
    \psframebox[fillstyle=gradient,gradmidpoint=0.2, gradangle=0,gradbegin=red!60!green!40, gradend=white]{\large  #2}%
    \hfil%
    \fi%
  }
  \else %sinon cadreTitre = false
  \newcommand{\structitre}{\large\textbf{#2} \styleSousTitre{\val@sousTitre}}%
  \fi%
  \begin{lrbox}{\invbox}%
\begin{minipage}{\dimexpr\linewidth-2\val@framesep-\ifKV@bclogo@noborder 0pt\else2\val@borderWidth\fi-\logowidth-\ifKV@bclogo@ombre\val@epOmbre cm\else0pt\fi\relax}% 
}%
{%
\end{minipage}%
\end{lrbox}%

% calcul de la hauteur totale de la boite interieure
\settoheight{\invboxh}{\usebox{\invbox}}%
\settodepth{\invboxd}{\usebox{\invbox}}%
\addtolength{\invboxh}{\invboxd}%

  % on commence la boite interieur ou est le texte et la barre vertical
  \begin{lrbox}{\envbox}%
   \begin{tabular}{@{}c@{}p{\dimexpr\linewidth-2\val@framesep-\ifKV@bclogo@noborder 0pt\else2\val@borderWidth\fi-\logowidth-\ifKV@bclogo@ombre\val@epOmbre cm\else0pt\fi}@{}}%
   \begin{minipage}{\logowidth}{\refstepcounter{bclogocompteur}\bccaption{\bclogotitre}\val@logo}\end{minipage}&%
   \ifKV@bclogo@cadreTitre%
 \begin{minipage}{\dimexpr\linewidth-2\val@framesep-\logowidth-\ifKV@bclogo@ombre\val@epOmbre cm\else0pt\fi}{\structitre}\end{minipage}%
   \else\structitre\fi\tabularnewline%
   \ifKV@bclogo@avecBarre% si il y a une barre verticale
   \bc@barre&\usebox{\invbox}%
   \else\multicolumn{2}{c}{\usebox{\invbox}}\fi%
   \end{tabular}%
  \end{lrbox}%

% Affiche l'ensemble dans un cadre en couleur.
  \iftikz% tikz
  \par\noindent
  \begin{tikzpicture}%
    \ifKV@bclogo@ombre%cadre ombre
    \ifKV@bclogo@blur%blur
    \node[%
preaction={line width=6,line join=round,opacity=0.1,draw=\val@couleurOmbre,transform canvas={xshift=\val@epOmbre cm, yshift=-\val@epOmbre cm}},%
preaction={line width=5,line join=round,opacity=0.15,draw=\val@couleurOmbre,transform canvas={xshift=\val@epOmbre cm, yshift=-\val@epOmbre cm}},%
preaction={line width=4,line join=round,opacity=0.2,draw=\val@couleurOmbre,transform canvas={xshift=\val@epOmbre cm, yshift=-\val@epOmbre cm}},%
preaction={line width=3,line join=round,opacity=0.3,draw=\val@couleurOmbre,transform canvas={xshift=\val@epOmbre cm, yshift=-\val@epOmbre cm}},%
preaction={line width=2,line join=round,opacity=0.4,draw=\val@couleurOmbre,transform canvas={xshift=\val@epOmbre cm, yshift=-\val@epOmbre cm}},%
preaction={line width=1,line join=round,opacity=0.5,draw=\val@couleurOmbre,transform canvas={xshift=\val@epOmbre cm, yshift=-\val@epOmbre cm}},%
general shadow={fill=\val@couleurOmbre,opacity=1,shadow xshift=\val@epOmbre cm, shadow yshift=-\val@epOmbre cm},%
fill=\val@couleur,shape=rectangle,line width=\val@borderWidth, inner sep=\val@framesep, rounded corners=\arr cm,%	
draw=\ifKV@bclogo@noborder none\else \val@couleurBord\fi]{\usebox{\envbox}};
    \else %ombre sans blur
    \node[fill=\val@couleur,shape=rectangle,line width=\val@borderWidth, inner sep=\val@framesep, rounded corners=\arr cm,%
    general shadow={fill=\val@couleurOmbre, shadow xshift=\val@epOmbre cm, shadow yshift=-\val@epOmbre cm}, draw=\ifKV@bclogo@noborder none\else \val@couleurBord\fi]{\usebox{\envbox}};
    \fi% fin ifblur	
    \else%cadre sans ombre
    \node[fill=\val@couleur,thick, shape=rectangle,line width=\val@borderWidth, inner sep=\val@framesep,rounded corners=\arr cm, draw=\ifKV@bclogo@noborder none\else \val@couleurBord\fi]{\usebox{\envbox}};
    \fi
  \end{tikzpicture}% 
  %\par%
  \else%  pstricks
  \noindent
  \ifKV@bclogo@ombre%cadre ombre
    \ifKV@bclogo@blur%blur
    \psframebox[cornersize=absolute,linearc=\dimexpr\arr cm * 2,fillstyle=solid, shadow=true, blur=true, shadowsize=\val@epOmbre cm,%
    shadowcolor=\val@couleurOmbre, fillcolor=\val@couleur,linewidth=\val@borderWidth, linestyle=\ifKV@bclogo@noborder none\else solid\fi,linecolor=\val@couleurBord]{\usebox{\envbox}}
    \else
    \psframebox[cornersize=absolute,linearc=\dimexpr\arr cm * 2,fillstyle=solid, shadow=true, shadowsize=\val@epOmbre cm,%
    shadowcolor=\val@couleurOmbre, fillcolor=\val@couleur,linewidth=\val@borderWidth,linestyle=\ifKV@bclogo@noborder none\else solid\fi,linecolor=\val@couleurBord]{\usebox{\envbox}}
    \fi
  \else%cadre sans ombre
  \psframebox[cornersize=absolute,linearc=\dimexpr\arr cm * 2  ,fillstyle=solid, fillcolor=\val@couleur,linewidth=\val@borderWidth, linestyle=\ifKV@bclogo@noborder none\else solid\fi,linecolor=\val@couleurBord]{\usebox{\envbox}}
  \fi%
  \fi%fin
  \ifKV@bclogo@ombre\vspace*{\val@epOmbre cm}\fi
}%
