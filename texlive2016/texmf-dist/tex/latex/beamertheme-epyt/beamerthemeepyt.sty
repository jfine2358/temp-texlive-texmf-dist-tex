% -*- coding: utf-8 -*-

\ProvidesPackage{beamerthemeepyt}[2016/05/14 v0.8]

\makeatletter

\RequirePackage{tikz}
\usetikzlibrary{patterns}

%%% presentation mode

\mode<presentation>

\def\beamer@epyt@style{default}
\DeclareOptionBeamer{style}[default]{\def\beamer@epyt@style{#1}}
\ProcessOptionsBeamer

%% basic settings

\setbeamersize{text margin left=8mm,text margin right=8mm}
%\geometry{hmargin=1em,vmargin=0em}

%% -------------------- outer templates --------------------

% make "vertical shading" modifiable in the middle of the document
% see beamerbaseauxtemplates.sty for the original code

\define@key{epyt@backgroundshade}{bottom}{\def\epyt@bgsb{#1}}
\define@key{epyt@backgroundshade}{middle}{\def\epyt@bgsm{#1}}
\define@key{epyt@backgroundshade}{top}{\def\epyt@bgst{#1}}
\define@key{epyt@backgroundshade}{midpoint}{\def\epyt@bgsmp{#1}}

\defbeamertemplate{background canvas}{myshading}[1][]
{%
  \setkeys{epyt@backgroundshade}{middle={},midpoint=0.5}%
  \setkeys{epyt@backgroundshade}{#1}%
  \pgfdeclareverticalshading[\epyt@bgsb,\epyt@bgsm,\epyt@bgst]%
    {epyt@backgroundshading}{\the\paperwidth}%
    {color(0cm)=(\epyt@bgsb);
     color(\epyt@bgsmp\paperheight)=(\epyt@bgsm);
     color(\the\paperheight)=(\epyt@bgst)}%
  \pgfuseshading{epyt@backgroundshading}%
}

\defbeamertemplate{background}{brick}
{%
  \usebeamercolor{normal text}%
  \begin{tikzpicture}
  \draw[pattern=bricks, pattern color=normal text.bg!80!black]
      (0,0) rectangle (\paperwidth-\pgflinewidth,\paperheight-\pgflinewidth);
  \end{tikzpicture}
}
\defbeamertemplate{background}{line}
{%
  \usebeamercolor{normal text}%
  \begin{tikzpicture}
  \draw[pattern=horizontal lines, pattern color=normal text.bg!90!normal text.fg]
      (0,0) rectangle (\paperwidth,\paperheight);
  \end{tikzpicture}
}

\defbeamertemplate{frametitle}{simple}
{%
  \noindent\usebeamerfont{frametitle}\insertframetitle\par
}
\setbeamertemplate{frametitle}[simple]

\setbeamertemplate{navigation symbols}{}

\defbeamertemplate{footline}{simple}
{
  \hbox{%
  \begin{beamercolorbox}[wd=.2\paperwidth,ht=2.25ex,dp=1ex,left]{footline}%
    \usebeamerfont{footline}\hspace*{\beamer@leftmargin}%
    \Acrobatmenu{GoToPage}{\insertframenumber{}/\inserttotalframenumber}
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.6\paperwidth,ht=2.25ex,dp=1ex,center]{footline}%
    \usebeamerfont{footline}\insertshorttitle
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.2\paperwidth,ht=2.25ex,dp=1ex,right]{footline}%
    \usebeamerfont{footline}%
    \hyperlinkframeendprev{$\vartriangle$}\hspace*{1ex}\hyperlinkframestartnext{$\triangledown$}%
    \hspace*{\beamer@rightmargin}
  \end{beamercolorbox}%
  }%
}
\defbeamertemplate{footline}{sectioning}
{
  \hbox{%
  \begin{beamercolorbox}[wd=.8\paperwidth,ht=2.25ex,dp=1ex,left]{footline}%
    \usebeamerfont{footline}\hspace*{\beamer@leftmargin}\insertshorttitle
    \ifx\insertsection\@empty\else\qquad$\vartriangleright$\qquad\insertsection\fi
    \ifx\insertsubsection\@empty\else\qquad$\vartriangleright$\qquad\insertsubsection\fi
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.2\paperwidth,ht=2.25ex,dp=1ex,right]{footline}%
    \usebeamerfont{footline}%
    \hyperlinkframeendprev{$\vartriangle$}
    \Acrobatmenu{GoToPage}{\insertframenumber{}/\inserttotalframenumber}
    \hyperlinkframestartnext{$\triangledown$}\hspace*{\beamer@rightmargin}
  \end{beamercolorbox}%
  }%
}
\setbeamertemplate{footline}[simple]

%% -------------------- inner template --------------------

\defbeamertemplate{title page}{simple}[1][]{
  \begin{beamercolorbox}[#1]{title}
    \usebeamerfont{title}\inserttitle
  \end{beamercolorbox}
  \ifx\insertsubtitle\@empty\else
  \vskip0.7em
    \begin{beamercolorbox}[#1]{subtitle}
      \usebeamerfont{subtitle}\insertsubtitle
    \end{beamercolorbox}
  \fi%
  \vskip2em{\color{text1!50!back1}\hrule}\vskip2em
  \begin{beamercolorbox}[#1]{author}
    \usebeamerfont{author}\insertauthor
  \end{beamercolorbox}
  \ifx\insertinstitute\@empty\else
  \vskip0.7em
    \begin{beamercolorbox}[#1]{institute}
      \usebeamerfont{institute}\insertinstitute
    \end{beamercolorbox}
  \fi%
  \vskip2em{\color{text1!50!back1}\hrule}\vskip2em
  \begin{beamercolorbox}[#1]{date}
  \usebeamerfont{date}\insertdate
  \end{beamercolorbox}
}

\defbeamertemplate{title page}{triangle}[1][]{
  \begin{beamercolorbox}[#1]{title}
    \usebeamerfont{title}\inserttitle
  \end{beamercolorbox}
  \ifx\insertsubtitle\@empty\else
  \vskip0.7em
    \begin{beamercolorbox}[#1]{subtitle}
      \usebeamerfont{subtitle}\insertsubtitle
    \end{beamercolorbox}
  \fi%
  \vskip18pt{%
    \color{text1!50!back1}\leavevmode\tiny
    \leaders\hbox to 1em{\hss$\triangleright$\hss}\hfill
  }\vskip18pt
  \begin{beamercolorbox}[#1]{author}
    \usebeamerfont{author}\insertauthor
  \end{beamercolorbox}
  \ifx\insertinstitute\@empty\else
  \vskip0.7em
    \begin{beamercolorbox}[#1]{institute}
      \usebeamerfont{institute}\insertinstitute
    \end{beamercolorbox}
  \fi%
  \vskip18pt{%
    \color{text1!50!back1}\leavevmode\tiny
    \leaders\hbox to 1em{\hss$\triangleleft$\hss}\hfill
  }\vskip18pt
  \begin{beamercolorbox}[#1]{date}
  \usebeamerfont{date}\insertdate
  \end{beamercolorbox}
}

\setbeamertemplate{itemize items}[default]
\setbeamertemplate{enumerate items}[default]

\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}{}

% sections and subsections

\AtBeginSection[]{\frame{\sectionpage}}

\defbeamertemplate{section page}{simple}{
  \begin{center}
    \usebeamerfont{section in toc}
    \tableofcontents[sectionstyle=show/hide,subsectionstyle=hide]
  \end{center}
}
\setbeamertemplate{section page}[simple]

\AtBeginSubsection[]{\frame{\subsectionpage}}

\defbeamertemplate{subsection page}{simple}{
  \begin{beamercolorbox}[wd=\paperwidth,center]{subsection in toc}%
  \usebeamerfont{subsection in toc}\insertsectionnumber.\insertsubsectionnumber\hspace*{2ex}\insertsubsection%
  \end{beamercolorbox}%
}
\setbeamertemplate{subsection page}[simple]

% disable block style for theorems

\defbeamertemplate{theorem begin}{simple}
{%
  \upshape%\bfseries\inserttheoremheadfont
  {\usebeamercolor[fg]{theoremname}%
  \inserttheoremname\inserttheoremnumber
  \ifx\inserttheoremaddition\@empty\else\ (\inserttheoremaddition)\fi%
  %\inserttheorempunctuation
  }%
  \quad\normalfont
}
\defbeamertemplate{theorem end}{simple}{\par}

\defbeamertemplate{proof begin}{simple}
{%
  %\bfseries
  {\usebeamercolor[fg]{proofname}\insertproofname}%
  \quad\normalfont
}
\defbeamertemplate{proof end}{simple}{\par}

%% -------------------- font theme --------------------

\setbeamerfont{title}{size=\LARGE}
\setbeamerfont{subtitle}{size=\large}
\setbeamerfont{author}{size=\large}
\setbeamerfont{institute}{size=\normalsize}
\setbeamerfont{date}{size=\large}
\setbeamerfont{section in toc}{size=\Large}
\setbeamerfont{subsection in toc}{size=\large}
\setbeamerfont{frametitle}{size=\large}

\usefonttheme{professionalfonts} % there is some problem with default math fonts
%\usepackage{arev}

%% -------------------- color theme --------------------

% always use rgb colors in pdf files
\substitutecolormodel{hsb}{rgb}

\def\beamer@epyt@style@do@alpha{
  \definecolor{gray1}{gray}{0.1}
  \definecolor{red69}{Hsb}{0,0.6,0.9}
  \definecolor{yellow69}{Hsb}{60,0.6,0.9}
  \definecolor{yellow99}{Hsb}{60,0.9,0.9}
  \definecolor{green69}{Hsb}{120,0.6,0.9}
  \definecolor{cyan69}{Hsb}{180,0.6,0.9}
  \definecolor{azure39}{Hsb}{210,0.3,0.9}
  \definecolor{magenta69}{Hsb}{300,0.6,0.9}
  \colorlet{text1}{white}
  \colorlet{back1}{black}
  \colorlet{accent1}{yellow69}
  \colorlet{accent2}{green69}
  \colorlet{accent3}{red69}
  \colorlet{accent4}{cyan69}
  \colorlet{accent5}{magenta69}
  \setbeamercolor{normal text}{bg=black,fg=white}
  \setbeamercolor{structure}{fg=yellow99}
  \setbeamercolor{local structure}{fg=azure39}
  \setbeamercolor{footline}{bg=,fg=white}
  \setbeamertemplate{background canvas}[myshading][top=black,middle=gray1,bottom=darkgray]
  \setbeamertemplate{background}[line]
  \setbeamertemplate{title page}[simple][left]
  \setbeamertemplate{theorem begin}[default]
  \setbeamertemplate{theorem end}[default]
  \setbeamertemplate{proof begin}[default]
  \setbeamertemplate{proof end}[default]
}
\def\beamer@epyt@style@do@beta{
  \definecolor{red99}{Hsb}{0,0.9,0.9}
  \definecolor{yellow86}{Hsb}{60,0.8,0.6}
  \definecolor{cyan95}{Hsb}{180,0.9,0.5}
  \definecolor{blue77}{Hsb}{240,0.7,0.7}
  \definecolor{blue99}{Hsb}{240,0.9,0.9}
  \definecolor{magenta88}{Hsb}{300,0.8,0.8}
  \colorlet{text1}{black}
  \colorlet{back1}{white}
  \colorlet{accent1}{blue99}
  \colorlet{accent2}{cyan95}
  \colorlet{accent3}{red99}
  \colorlet{accent4}{yellow86}
  \colorlet{accent5}{magenta88}
  \setbeamercolor{normal text}{bg=white,fg=black}
  \setbeamercolor{structure}{fg=blue99}
  \setbeamercolor{local structure}{fg=cyan95}
  \setbeamercolor{footline}{bg=blue77,fg=white}
  \setbeamertemplate{background canvas}[default]
  \setbeamertemplate{background}[line]
  \setbeamertemplate{title page}[triangle][center]
  \setbeamertemplate{theorem begin}[simple]
  \setbeamertemplate{theorem end}[simple]
  \setbeamertemplate{proof begin}[simple]
  \setbeamertemplate{proof end}[simple]
}
\def\beamer@epyt@style@do@delta{
  \definecolor{red69}{Hsb}{0,0.6,0.9}
  \definecolor{yellow69}{Hsb}{60,0.6,0.9}
  \definecolor{yellow99}{Hsb}{60,0.9,0.9}
  \definecolor{green69}{Hsb}{120,0.6,0.9}
  \definecolor{cyan69}{Hsb}{180,0.6,0.9}
  \definecolor{azure39}{Hsb}{210,0.3,0.9}
  \definecolor{blue77}{Hsb}{240,0.7,0.7}
  \definecolor{blue88}{Hsb}{240,0.8,0.8}
  \definecolor{blue97}{Hsb}{240,0.9,0.7}
  \definecolor{magenta69}{Hsb}{300,0.6,0.9}
  \definecolor{purple94}{Hsb}{330,0.9,0.4}
  \colorlet{text1}{white}
  \colorlet{back1}{blue77}
  \colorlet{accent1}{yellow69}
  \colorlet{accent2}{green69}
  \colorlet{accent3}{red69}
  \colorlet{accent4}{cyan69}
  \colorlet{accent5}{magenta69}
  \setbeamercolor{normal text}{bg=blue77,fg=white}
  \setbeamercolor{structure}{fg=yellow99}
  \setbeamercolor{local structure}{fg=azure39}
  \setbeamercolor{footline}{bg=purple94,fg=white}
  \setbeamercolor{navigation symbols}{bg=purple94}
  \setbeamercolor{navigation symbols dimmed}{fg=purple94}
  \setbeamertemplate{background canvas}[myshading][top=blue97,middle=blue77,bottom=blue97]
  \setbeamertemplate{background}[grid][step=1mm,color=blue88]
  \setbeamertemplate{title page}[simple][center]
  \setbeamertemplate{theorem begin}[simple]
  \setbeamertemplate{theorem end}[simple]
  \setbeamertemplate{proof begin}[simple]
  \setbeamertemplate{proof end}[simple]
}
\def\beamer@epyt@style@do@gamma{
  \definecolor{red69}{Hsb}{0,0.6,0.9}
  \definecolor{brown96}{Hsb}{30,0.9,0.6}
  \definecolor{yellow69}{Hsb}{60,0.6,0.9}
  \definecolor{green33}{Hsb}{120,0.3,0.3}
  \definecolor{green39}{Hsb}{120,0.3,0.9}
  \definecolor{green53}{Hsb}{120,0.5,0.3}
  \definecolor{green69}{Hsb}{120,0.6,0.9}
  \definecolor{cyan69}{Hsb}{180,0.6,0.9}
  \definecolor{magenta69}{Hsb}{300,0.6,0.9}
  \colorlet{text1}{white}
  \colorlet{back1}{green33}
  \colorlet{accent1}{yellow69}
  \colorlet{accent2}{green69}
  \colorlet{accent3}{red69}
  \colorlet{accent4}{cyan69}
  \colorlet{accent5}{magenta69}
  \setbeamercolor{normal text}{bg=green33,fg=white}
  \setbeamercolor{structure}{fg=yellow}
  \setbeamercolor{local structure}{fg=green39}
  \setbeamercolor{footline}{bg=brown96,fg=white}
  \setbeamercolor{navigation symbols}{bg=brown96}
  \setbeamercolor{navigation symbols dimmed}{fg=brown96}
  \setbeamertemplate{background canvas}[default]
  \setbeamertemplate{background}[grid][step=1mm,color=green53]
  \setbeamertemplate{title page}[triangle][left]
  \setbeamertemplate{theorem begin}[default]
  \setbeamertemplate{theorem end}[default]
  \setbeamertemplate{proof begin}[default]
  \setbeamertemplate{proof end}[default]
}
\def\beamer@epyt@style@do@zeta{
  \definecolor{red85}{Hsb}{0,0.8,0.5}
  \definecolor{red87}{Hsb}{0,0.8,0.7}
  \definecolor{yellow69}{Hsb}{60,0.6,0.9}
  \definecolor{yellow99}{Hsb}{60,0.9,0.9}
  \definecolor{green69}{Hsb}{120,0.6,0.9}
  \definecolor{cyan69}{Hsb}{180,0.6,0.9}
  \definecolor{blue5x}{Hsb}{240,0.5,1}
  \definecolor{magenta6x}{Hsb}{300,0.6,1}
  \colorlet{text1}{white}
  \colorlet{back1}{red87}
  \colorlet{accent1}{yellow69}
  \colorlet{accent2}{green69}
  \colorlet{accent3}{magenta6x}
  \colorlet{accent4}{cyan69}
  \colorlet{accent5}{blue5x}
  \setbeamercolor{normal text}{bg=red87,fg=white}
  \setbeamercolor{structure}{fg=yellow99}
  \setbeamercolor{local structure}{fg=yellow99}
  \setbeamercolor{footline}{bg=black,fg=white}
  \setbeamercolor{navigation symbols}{bg=black}
  \setbeamercolor{navigation symbols dimmed}{fg=black}
  \setbeamertemplate{background canvas}[myshading][top=red85,middle=red87,bottom=red85]
  \setbeamertemplate{background}[brick]
  \setbeamertemplate{title page}[simple][center]
  \setbeamertemplate{theorem begin}[default]
  \setbeamertemplate{theorem end}[default]
  \setbeamertemplate{proof begin}[default]
  \setbeamertemplate{proof end}[default]
}
\let\beamer@epyt@style@do@default=\beamer@epyt@style@do@beta

\def\beamer@epyt@style@do@common{
  \colorlet{filler1}{accent1!50!back1}
  \colorlet{filler2}{accent2!50!back1}
  \colorlet{filler3}{accent3!50!back1}
  \colorlet{filler4}{accent4!50!back1}
  \colorlet{filler5}{accent5!50!back1}
  \setbeamercolor{title}{use=structure,fg=structure.fg}
  \setbeamercolor{subtitle}{use={structure,normal text},fg=structure.fg!90!normal text.bg}
  \setbeamercolor{section in toc}{parent=title}
  \setbeamercolor{subsection in toc}{parent=subtitle}
  \setbeamercolor{frametitle}{parent=title}
  \setbeamercolor{theoremname}{parent=subtitle}
  \setbeamercolor{proofname}{parent=subtitle}
  \setbeamercolor{block title}{fg=accent1,bg=darkgray}
  \setbeamercolor{block body}{bg=gray}
  \setbeamercolor{block title example}{fg=accent2,bg=darkgray}
  \setbeamercolor{block body example}{bg=gray}
  \setbeamercolor{block title alerted}{fg=accent3,bg=darkgray}
  \setbeamercolor{block body alerted}{bg=gray}
}

%% apply user selected theme at last

\def\beamer@epyt@style@do{%
  \expandafter\let\expandafter\next
    \csname beamer@epyt@style@do@\beamer@epyt@style\endcsname
  \ifx\next\relax \let\next\beamer@epyt@style@do@default \fi
  \next
  \beamer@epyt@style@do@common
  % need this when switching color themes in the middle of the document
  \usebeamercolor[fg]{normal text}%
  %\renewcommand{\normalcolor}{\color{normal text.fg}}%
}

\beamer@epyt@style@do

\RequirePackage{xkeyval}
\define@key{epytsetup}{style}{\def\beamer@epyt@style{#1}}
\newcommand{\epytsetup}[1]{%
  \setkeys{epytsetup}{#1}%
  \beamer@epyt@style@do
}

%% empty background colors for handout

\mode<handout>{
  \setbeamertemplate{background canvas}{}
  \setbeamertemplate{background}{}
  \setbeamercolor{normal text}{fg=black, bg=white}
  \setbeamercolor{title}{fg=blue}
  \setbeamercolor{subtitle}{fg=blue!70!gray}
  \setbeamercolor{section in toc}{fg=blue!90!gray}
  \setbeamercolor{subsection in toc}{fg=blue!80!gray}
  \setbeamercolor{frametitle}{fg=blue!70!gray}
  \setbeamercolor{theoremname}{fg=blue!60!gray}
  \setbeamercolor{proofname}{fg=blue!60!gray}
  \setbeamercolor{footline}{bg=white,fg=black}
}

\mode
<all>

\makeatother
